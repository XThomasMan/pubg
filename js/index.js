var resPath="//game.gtimg.cn/images/pubgm/cp/a20171220pubgm/",res=[resPath+"img/bg/bg-index-1.jpg",resPath+"img/bg/bg-index-2.jpg",resPath+"img/bg/bg-index-3.jpg",resPath+"img/bg/bg-index-4.jpg",resPath+"img/bg/bg-index-5.jpg",resPath+"img/bg/bg-index-6.jpg",resPath+"img/bg/bg-index-7.jpg",resPath+"img/bg/bg-index-8.jpg",resPath+"img/bg/bg-index-9.jpg",resPath+"img/bg/bg-index-10.jpg",resPath+"img/bg/bg-index-11.jpg",resPath+"img/bg/bg-index-12.jpg",resPath+"img/bg/bg-index-13.jpg",resPath+"img/bg/bg-index-14.jpg",resPath+"img/bg/bg-index-15.jpg",resPath+"img/bg/bg-index-16.jpg",resPath+"img/bg/bg-index-17.jpg",resPath+"img/bg/bg-index-18.jpg",resPath+"img/bg/bg-index-19.jpg",resPath+"img/bg/bg-index-20.jpg",resPath+"img/anit/sprites-anit-1.png",resPath+"img/anit/sprites-anit-2.png",resPath+"img/anit/sprites-anit-3.png",resPath+"img/anit/sprites-anit-4.png",resPath+"img/anit/sprites-anit-5.png",resPath+"img/anit/sprites-anit-6.png",resPath+"img/anit/sprites-anit-7.png",resPath+"img/anit/sprites-anit-8.png",resPath+"img/anit/sprites-anit-11.png",resPath+"img/anit/sprites-anit-12.png",resPath+"img/anit/sprites-anit-13.png",resPath+"img/anit/sprites-anit-14.png",resPath+"img/anit/sprites-anit-15.png",resPath+"img/anit/sprites-anit-16.png",resPath+"img/anit/bg-anit-9.png",resPath+"img/sprites-people.png",resPath+"img/sprites-guide.png",resPath+"img/bg-correct.png",resPath+"img/bg-ribbon.png",resPath+"img/bg-qrcode.png",resPath+"img/sprites-widget.png",resPath+"img/sprites-title.png",resPath+"img/sprites-audio.png",resPath+"img/bg-kv.jpg",resPath+"img/sprites-kv.png",resPath+"img/bg-cloud-1.png",resPath+"img/bg-cloud-2.png",resPath+"img/text/bg-text-1.png",resPath+"img/text/bg-text-2.png",resPath+"img/text/bg-text-3.png",resPath+"img/text/bg-text-4.png",resPath+"img/text/bg-text-5.png",resPath+"img/text/bg-text-6.png",resPath+"img/desc/bg-desc-1.png",resPath+"img/desc/bg-desc-2.png",resPath+"img/desc/bg-desc-3.png",resPath+"img/desc/bg-desc-4.png",resPath+"img/desc/bg-desc-5.png",resPath+"img/desc/bg-desc-6.png"],myScroll={},sound={},isReset=!1,pageH=603,pageW=375,width=window.innerWidth,height=window.innerHeight,pageRatio=pageH/pageW,windowRatio=height/width,questionIndex=0,isMove=!1,isEnter9=!1,clickCount=0,nickname="你",shotPosition=600,questionPosition=[1805,4204,8347,10806,13036,15466,18845,20948,23625,25097],answer=[2,2,1,4,1,2,3,4,[1,3,5,6],[3,4]],question9=[],proportion=height/pageH/(windowRatio/pageRatio),multiple=.5*proportion,$guide=$("#guide"),$text=$("#text"),$cloud=$(".kv-cloud"),$desc=$("#desc"),$sharePic=$("#sharePic"),audio={$voice:$("#music"),oAudio:document.getElementById("audio"),audioEvent:function(){var t=this;t.oAudio&&(t.oAudio.addEventListener("canplaythrough",function(){t.oAudio.play()}),t.oAudio.addEventListener("timeupdate",function(){t.oAudio.currentTime>=t.oAudio.duration-1&&(t.oAudio.currentTime=0,t.oAudio.play())},!1))},playAudio:function(t,i){var e=this;e.oAudio&&(e.oAudio.src=t,i&&e.startAudio())},startAudio:function(){var t=this;t.oAudio&&(t.$voice.removeClass("music__off").addClass("music__on"),t.oAudio.load(),t.oAudio.play(),t.state.status=!0)},stopAudio:function(){var t=this;t.oAudio&&(t.$voice.removeClass("music__on").addClass("music__off"),t.oAudio.pause(),t.state.status=!1)},event:function(){var t=this;t.$voice.on("touchend",function(){return t.state.status?t.stopAudio():t.startAudio(),!1})},init:function(){var t=this;t.state={status:!1},t.state.status=!0,t.event(),t.playAudio(resPath+"media/music.mp3",t.state.status),document.addEventListener("WeixinJSBridgeReady",function(){t.startAudio()},!1)}},IndexPage={init:function(){document.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),this.loading(),this.login()},loading:function(){var t=this;new mo.Loader(res,{loadType:1,minTime:300,onLoading:function(t,i){var e=parseInt(t/i*100);$("#progressBar").css("transform","translate("+(-100+e)+"%, 0)"),setTimeout(function(){$("#doll").html(10-parseInt(e/10))},0)},onComplete:function(){$("#loading").addClass("hide"),t.initAudio(),t.playAudio(resPath+"media/airplane.wav"),$(".people").addClass("active"),t.bindEvents()}})},reset:function(){questionIndex=0,myScroll.scrollTo(0,0),question9=[],$(".btn").removeClass("active correct"),$("#kv").removeClass("active error"),$("#mask").removeClass("active"),$("#ribbon").removeClass("active"),$cloud.removeClass("active"),$desc.removeClass("active"),$text.removeClass("active"),$("#chicken").removeClass("active"),$(".page-question").removeClass("active"),audio.startAudio(),isEnter9=!1,isReset=!0},initAudio:function(){for(var t=[resPath+"media/victory.mp3",resPath+"media/airplane.wav",resPath+"media/shot.wav",resPath+"media/correct.mp3",resPath+"media/error.mp3"],i=0;i<t.length;i++){var e=new Audio;e.src=t[i],e.preload=!0,e.load()}},playAudio:function(t){sound=document.getElementById("audio2"),sound.src=t,sound.load(),sound.play()},action:function(){function t(t){var i=-questionPosition[questionIndex]*multiple;i>=t&&($(".page-question-"+(parseInt(questionIndex)+1)).addClass("active"),isMove=!1,myScroll.scrollTo(0,i))}myScroll=new IScroll("#wrapper",{mouseWheel:!0,useTransform:!0,preventDefault:!0,probeType:3}),myScroll.on("scroll",function(){isMove=!0,$guide.removeClass("active"),t(this.y)}),myScroll.on("scrollEnd",function(){isMove=!1,t(this.y)}),myScroll.on("scrollStart",function(){isMove=!0})},showKV:function(t,i){function e(){$("#kv").addClass(i?"active":"error").off("webkitAnimationEnd").on("webkitAnimationEnd",function(){$desc.addClass("active"),$text.addClass("active"),$cloud.addClass("active")}),$("#chicken").addClass("active"),a.share(nickname,t)}var n,a=this;2>=t?n=1:4>=t?n=2:6>=t?n=3:8>=t?n=4:10>=t?n=5:11==t&&(n=6);var s=resPath+"img/text/bg-text-"+n+".png",o=resPath+"img/desc/bg-desc-"+n+".png";$desc.attr("src",o),$text.attr("src",s),a.makeImg(n),$("#mask").addClass("active").off("webkitAnimationEnd").on("webkitAnimationEnd",function(){i?(a.playAudio(resPath+"media/victory.mp3"),$("#ribbon").addClass("active").off("webkitAnimationEnd").on("webkitAnimationEnd",e)):e()})},login:function(){var t=this;TGLogin.init({wxAppId:"wx13051697527efc45"},function(i){var e=i.mGetPlatformType();"wx"===e?i.mWXLogin(function(i){nickname=i.nickname,t.share(nickname,0)}):"qq"===e?i.mQQLogin(function(i){nickname=i.nickname,t.share(nickname,0)}):i.mOpenQQ()})},share:function(t,i){var e="这是我做过的最奇葩的游戏水平测试了，坑到爆炸！";i>=1&&3>=i?e=t+"的坑货指数是“无底黑洞”！只有填不满的洞，没有坑不掉的人！":i>3&&8>=i?e=t+"的坑货指数是“百人坑”！队友见了会流泪，佛祖见了会心碎！":i>8&&10>=i?e=t+"的坑货指数是“小水坑”！ 军功章有他躺赢的一半！":11==i&&(e=t+"的坑货指数是“平原飞驰”！不坑，贼稳！"),TGMobileShare({shareTitle:"绝地求生 全军出击",shareDesc:e,timelineTitle:e,shareImgUrl:resPath+"img/share.png",shareLink:"",actName:"a20171220pubgm"})},makeImg:function(t){var i=document.createElement("canvas"),e=i.getContext("2d"),n=1206*proportion;i.width=2*width,i.height=n>2*height?n:2*height,e.fillStyle="#fff8f6",e.fillRect(0,0,i.width,i.height);var a=new Image,s=resPath+"img/bg-kv.jpg",o=resPath+"img/bg-cloud-2.png",r=resPath+"img/bg-cloud-1.png",g=resPath+"img/desc/bg-desc-"+t+".png",d=resPath+"img/text/bg-text-"+t+".png",c=resPath+"img/bg-qrcode.png";a.setAttribute("crossOrigin","anonymous"),a.onload=function(){e.drawImage(this,0,0,i.width,1220*proportion),a.onload=function(){e.drawImage(this,135*proportion,574*proportion,480*proportion,242*proportion),a.onload=function(){e.drawImage(this,178*proportion,884*proportion,394*proportion,86*proportion),a.onload=function(){e.drawImage(this,-300*proportion,648*proportion,653*proportion,272*proportion),a.onload=function(){e.drawImage(this,420*proportion,608*proportion,733*proportion,395*proportion),a.onload=function(){e.drawImage(this,302*proportion,1010*proportion,144*proportion,160*proportion),$sharePic.attr("src",i.toDataURL())},a.src=c},a.src=r},a.src=o},a.src=d},a.src=g},a.src=s},bindEvents:function(){function t(t,i){for(var e=0;e<t.length;e++)if(t[e]==i){t.splice(e,1);break}}var i=this;$(document).on("touchend",function(){1>clickCount?($("#windows1").addClass("active"),clickCount++):2>clickCount?($("#windows2").addClass("active"),clickCount++):3>clickCount&&(i.action(),$("#guide2").addClass("hide"),$("#windows3").addClass("active").off("webkitAnimationEnd").on("webkitAnimationEnd",function(){$("#tips").addClass("active").off("webkitAnimationEnd").on("webkitAnimationEnd",function(){$guide.addClass("active")})}),i.playAudio(resPath+"media/shot.wav"),myScroll.scrollTo(0,-shotPosition*multiple,1e3),clickCount++)}),$(".btn").on("tap",function(){if(!isMove){var e=$(this),n=e.data("value");if(e.hasClass("btn-3"))e.hasClass("active")?isEnter9||(e.removeClass("active"),t(question9,parseInt(n))):(e.addClass("active"),question9.push(parseInt(n)));else if(e.hasClass("btn-4")){if(!isEnter9){var a=0;isEnter9=!0;for(var s=0;s<answer[questionIndex].length;s++)if(question9.length>0)for(var o=0;o<question9.length;o++)answer[questionIndex][s]===question9[o]&&($(".page-question-9").find(".btn-3").eq(question9[o]-1).addClass("correct"),a++);a==answer[questionIndex].length?(i.playAudio(resPath+"media/correct.mp3"),!isReset&&$guide.addClass("active"),questionIndex++):(i.playAudio(resPath+"media/error.mp3"),i.showKV(parseInt(questionIndex)+1,!1))}}else if(!e.siblings(".btn").hasClass("active")&&!e.hasClass("active")){e.addClass("active");var r=!1,g=answer[questionIndex];if("object"==typeof g)for(var s=0;s<g.length;s++)parseInt(n)==g[s]&&(r=!0);parseInt(n)==g||r?(e.addClass("correct"),i.playAudio(resPath+"media/correct.mp3"),9==questionIndex?i.showKV(11,!0):(!isReset&&$guide.addClass("active"),questionIndex++)):(i.playAudio(resPath+"media/error.mp3"),i.showKV(parseInt(questionIndex)+1,!1))}}}),$("#subscribe").on("touchend",function(){try{PTTSendClick("btn","link","跳转按钮")}catch(t){}setTimeout(function(){location.href="http://pubgm.qq.com/act/a20171121yym/index.shtml?ADTAG=cop.innercop.yxrs.index_yxrs"},100)}),$("#reset").on("touchend",i.reset)}};$(function(){IndexPage.init()}),audio.init();